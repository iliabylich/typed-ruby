#!/usr/bin/env ruby

require 'bundler/setup'
require 'typed_ruby'
require 'pry'

registry = TypedRuby::Registry.new
source = <<-RUBY

  class A
    def integer
      123
    end

    def double_integer
      a = integer
      a + a
    end
  end

RUBY

registry.register_class(
  __A = TypedRuby::Signatures::Class.new(
    name: 'A',
    superclass: registry.find_class('Object')
  )
)

__A.define_method(
  TypedRuby::Signatures::Method.new(
    name: 'integer',
    returns: TypedRuby::Types::InstanceOf.new(registry.find_class('Integer'))
  )
)

__A.define_method(
  TypedRuby::Signatures::Method.new(
    name: 'double_integer',
    returns: TypedRuby::Types::InstanceOf.new(registry.find_class('Integer'))
  )
)

ast = TypedRuby::AST::Parser.new(file: 'eval', source: source).parse

reducer = TypedRuby::AST::Reducer.new(ast: ast, registry: registry)

result = reducer.result

puts result
