#!/usr/bin/env ruby

require 'bundler/setup'
require 'typed_ruby'
require 'pry'

registry = TypedRuby::Registry
registry.load_file('bin/smoke.sig')

registry.classes.each do |klass|
  print "class #{klass.name}"

  if klass.superclass
    puts " < #{klass.superclass.name}"
  else
    puts
  end

  klass.included_modules.each do |mod|
    puts "  include #{mod.name}"
  end

  klass.prepended_modules.each do |mod|
    puts "  prepend #{mod.name}"
  end

  klass.own_methods.each do |method|
    puts "  def #{method.name}(#{method.arguments.map(&:inspect).join(', ')}): #{method.returns.inspect}"
  end
  puts "end"
end

registry.modules.each do |mod|
  puts "class #{mod.name}"

  mod.included_modules.each do |mod|
    puts "  include #{mod.name}"
  end

  mod.prepended_modules.each do |mod|
    puts "  prepend #{mod.name}"
  end

  mod.own_methods.each do |method|
    puts "  def #{method.name}(#{method.arguments.map(&:inspect).join(', ')}): #{method.returns.inspect}"
  end
  puts "end"
end
